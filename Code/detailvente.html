<!DOCTYPE html>
<html>
<head>
  <title>Détails des Ventes</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <style>
    /* CSS pour la mise en page */
    body {
      font-family: Arial, sans-serif;
    }

    h1 {
      text-align: center;
    }

    table {
      margin: 20px auto;
    }

    th, td {
      padding: 10px;
      text-align: center;
    }
    
    .totals {
      text-align: center;
      margin-top: 20px;
    }
    
    .totals h3 {
      margin-bottom: 10px;
    }
    
    .totals p {
      margin: 0;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      // Récupérer l'historique des ventes depuis le stockage local
      var salesHistory = localStorage.getItem('salesHistory');
      if (!salesHistory) {
        salesHistory = [];
      } else {
        salesHistory = JSON.parse(salesHistory);
      }

      // Afficher les détails des ventes
      function showSalesDetails() {
        var salesDetailsTable = $('#sales-details-table tbody');
        salesDetailsTable.empty();

        for (var i = 0; i < salesHistory.length; i++) {
          var salesData = salesHistory[i];
          var items = salesData.items;

          var rowHtml = '<tr>';

          // Ajouter les détails de chaque panier
          var basketHtml = '';
          for (var fruit in items) {
            var fruitItem = items[fruit];

            for (var variety in fruitItem) {
              var quantity = fruitItem[variety];

              basketHtml += fruit + ' (' + variety + '): ' + quantity + '<br>';
            }
          }
          rowHtml += '<td>' + basketHtml + '</td>';

          rowHtml += '</tr>';

          salesDetailsTable.append(rowHtml);
        }
        
        // Calculer les totaux pour chaque mode de paiement
        var cardTotal = 0;
        var chequeTotal = 0;
        var especeTotal = 0;
        for (var j = 0; j < salesHistory.length; j++) {
          var salesDataItem = salesHistory[j];
          var paymentMethod = salesDataItem.paymentMethod;
          var total = salesDataItem.total;

          if (paymentMethod === 'Carte') {
            cardTotal += total;
          } else if (paymentMethod === 'Chèque') {
            chequeTotal += total;
          } else if (paymentMethod === 'Espèces') {
            especeTotal += total;
          }
        }
        
        // Afficher les totaux
        var totalsHtml = '<div class="totals">';
        totalsHtml += '<h3>Totaux :</h3>';
        totalsHtml += '<p>Totaux Carte: ' + cardTotal.toFixed(2) + '</p>';
        totalsHtml += '<p>Totaux Chèque: ' + chequeTotal.toFixed(2) + '</p>';
        totalsHtml += '<p>Totaux Espèces: ' + especeTotal.toFixed(2) + '</p>';
        totalsHtml += '</div>';
        
        $('#totals-container').html(totalsHtml);
      }

      // Gérer le clic sur le bouton "Nouvelle Journée"
      $('#new-day-button').click(function() {
        // Supprimer les paniers dans l'historique des ventes
        salesHistory = [];
        localStorage.setItem('salesHistory', JSON.stringify(salesHistory));

        // Actualiser l'affichage
        showSalesDetails();
      });

      // Afficher les détails des ventes lors du chargement de la page
      showSalesDetails();
    });
  </script>
</head>
<body>
  <h1>Détails des Ventes</h1>

  <table id="sales-details-table" class="table table-bordered">
    <thead>
      <tr>
        <th scope="col">Panier</th>
      </tr>
    </thead>
    <tbody>
      <!-- Les données seront ajoutées ici -->
    </tbody>
  </table>

  <div id="totals-container"></div>

  <div class="text-center">
    <button id="new-day-button" class="btn btn-primary">Nouvelle Journée</button>
  </div>
</body>
</html>
